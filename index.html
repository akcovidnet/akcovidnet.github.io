
<html>
<head>
  <meta name="Description" CONTENT="Alaska COVID-19 Testing Sites - Find a COVID-19 testing site by Alaska Community">
<title>Alaska COVID-19 Testing Sites</title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-70817-22"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70817-22');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
 -->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-70817-22', 'auto');
ga('send', 'pageview');
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.js"></script> -->


<!--  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
 <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
 <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script> -->
<!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.2/b-colvis-1.6.2/b-flash-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/fh-3.1.7/kt-2.5.2/r-2.2.5/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.1/sl-1.3.1/datatables.min.css"/>
 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.2/b-colvis-1.6.2/b-flash-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/fh-3.1.7/kt-2.5.2/r-2.2.5/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.1/sl-1.3.1/datatables.min.js"></script>
 -->
<style>

   body {font-family: sans-serif;}
   td {
    vertical-align: top;
   }

   h1 {
    color:gold;
    background-color: blue;
    display:block;
    padding:10px;
    font-size:1.25em;
     vertical-align: baseline;
   }



   h1 a {
    color:white;
    text-decoration: none;

   }
   h1 span {
    color:lightblue;
   }
   h1 a:hover {
    text-decoration: underline;
   }

   .city h2 {
    color: blue;
    border:1px solid blue;
    padding:10px;
    display:block;
    background-color: blue;
    color:gold;
   }

   .clinic {
    margin-left:10px;
    padding:10px;
    border:1px dotted blue;
    max-width: 600px;
   }

   .clinic span {
    font-weight: bold;
   }


   #citylinks a {
    margin-right:15px;
   
      }

   #citylinks {
    display: none;
    max-width:600px;
   }

   #menubox, #menu {
/*    font-size:1.5em;*/
border-color: 1px solid green;
font-size: 1.25em;

   }

#menubox {
    background-color: lightgreen;
    font-weight: bold;
   }


#menuboxloading {
  background-color:orange;
}

   select{
    font-size: 1.25em;
   }


   .about {
    padding-bottom:1em;
    max-width: 670px;
    /*border:1px solid red;*/
   
   }

   .notes{

    max-width:500px;
   }

   .opennew {
    float:right;
    background-color: white;
    font-size:.9em;
    color:blue;
    font-weight: normal;
    line-height: inherit;
    text-decoration: none;
/*    vertical-align: baseline;*/
   }

   .opennew:hover{
    color:white;
    text-decoration: underline;
   
   }

   .openew img {
    vertical-align: middle;
   }
/*   .clinic * {
   
   display:none;
   }

    .clinic h3 {
    color: red;
    visibility: visible;
    display:inline;
   }

    address{
    display: inline;

   }*/

</style> 


</head>

<body>
<a name="enlarge" />
<h1><a id="sitelink" target="_blank" href="https://akcovid.net">akcovid.net</a> <span>|</span> COVID-19 Testing Sites in Alaska <a class="opennew" target="_new" href="https://akcovid.net/#enlarge"><img src="Maximise.svg">Enlarge</a></h1>

<div class="about">






<div style="padding:5px;font-weight: bold;">
  Anyone with any symptom of COVID-19 should get tested as soon as possible.
  <br>
<img style="max-width: 500px;padding:2px;" src="symptomlist.png"><br>
  If you feel sick and have reason to believe you have COVID-19 <em style="color:red;">do not go to a clinic or hospital without first calling ahead </em>. Calling first will help the clinic or hospital prepare to greet you and take care of you in the safest possible way. 
</div>
<!--   <span style="background-color:red;color:white;">This data is retrieved from the Alaska DHSS Covid Testing Sites page. </span><br> -->
  
</div>

<div id="citylinks">
    <h2>Choose your community</h2>
</div>



<div class="menubox" id="menuboxloading" style="border:3px solid orange;padding:5px;">
<img height="25" width="25" src="loader.gif">Loading Data from State of Alaska
</div>

<div class="menubox" id="menuboxsoa" style="border:3px solid orange;padding:5px;display:none;">
Slow to load Testing Site Data from State of Alaska. Using Cached Copy Instead.
</div>

<div class="menubox" id="menuboxfail" style="border:3px solid orange;padding:5px;background-color:orange;display:none;">
Unable to load Testing Site Data from State of Alaska or Cached Copy. Please try again later.
</div>

<div class="menubox" id="menubox" style="background-color: lightgreen;padding:5px;">
    View Testing Sites For:  <select id="menu">
        <option>Choose Your Community</option>
    </select>
</div>

<div id="abouttext">
   <br><em>About this page:</em> The <a href="https://dhss.alaska.gov/dph/Epi/id/Pages/COVID-19/default.aspx">State of Alaska DHSS</a> maintains testing site data as a <a href="https://coronavirus-response-alaska-dhss.hub.arcgis.com/app/2d92b77bc8044329a1ee3954b063bd8c">Map</a>.
    This page retrieves data from <a href="https://coronavirus-response-alaska-dhss.hub.arcgis.com/datasets/testing-sites-public-view/data?geometry=10.547%2C-88.438%2C-10.547%2C88.438">DHSS</a> in real time and displays it broken down by community and testing site. <a target="_blank"  href="https://forms.gle/iPnjCjgpWwSEpySv8">Have feedback?</a>. 
</div>

<script>





function inIframe () {
    try {
        return window.self !== window.top;
    } catch (e) {
        return true;
    }
}






  // if (inIframe()){
  //   $(".about").hide();
  //   $("#abouttext").hide();
  // }
  // if (inIframe()){
//$('#sitelink').setAttribute('target','_top');
  // }

  function cleanCity(city){
    var city = city.trim();
    var remove = ', AK';
    //console.log(city);
    city = city.replace('ANVSA, AK, USA','')
    city = city.replace(', AK','');
    city = city.replace(', Ak','');
    //console.log("replaced",city);
    return city.trim();
  }

    $(function() {
    $("#menu").change(function() {
        var city = $(this).find("option:selected")[0].value;
        location.hash = "" + $(this).find("option:selected")[0].value;
        ga('send', 'event', 'search', 'city', city);

    });
});




function keys(obj)
{
    var keys = [];

    for(var key in obj)
    {
        if(obj.hasOwnProperty(key))
        {
            keys.push(key);
        }
    }

    return keys;
}

function fillTemplate(fields){

function lu(f){
    if (fields[f] == null || fields[f]==undefined){
        return '';
    } else {
        return fields[f].trim();
    }
}

function email(x){
    if (x != ''){
        return '<a href="mailto:'+x+'">'+x+'</a>';
    } else {
        return '';
    }
}

function tel(x){
    if (x != ''){
        return '<a href="tel:'+x+'">'+x+'</a>';
    } else {
        return '';
    }
}

function labelPair(label,value){
  if (value.trim() != ''){
    return '<div>'+label+' ' + value + '</div>';
  } else {
    return '';
  }
}

var template = `<div class='clinic'>
<h3 >`+lu('name_of_collection_site')+`</h3>


`+labelPair('<span class="short">Phone:</span>',tel(lu('public_contact_number_if_availa')))+`
`+labelPair('<span class="short">Email:</span>',email(lu('public_e_mail_for_site_informat')))+`

<div><span class="short">Address:</span> `+lu('address')+` `+cleanCity(lu('city'))+` AK `+lu('zipcode')+`</div>
<br/>
<div><em>Hours</em></div>

<div><span class='hours'>Monday:</span> `+lu('monday')+` `+lu('hours_open_monday')+`</div>
<div><span class='hours'>Tuesday:</span> `+lu('tuesday')+` `+lu('hours_open_tuesday')+`</div>
<div><span class='hours'>Wednesday:</span> `+lu('wednesday')+` `+lu('hours_open_wednesday')+`</div>
<div><span class='hours'>Thursday:</span> `+lu('thursday')+` `+lu('hours_open_thursday')+`</div>
<div><span class='hours'>Friday:</span> `+lu('friday')+` `+lu('hours_open_friday')+`</div>
<div><span class='hours'>Saturday:</span> `+lu('saturday')+` `+lu('hours_open_saturday')+`</div>
<div><span class='hours'>Sunday:</span> `+lu('sunday')+` `+lu('hours_open_sunday')+`</div>
<br/>
<div><span class='wide'>Medical Referral Needed:</span> `+lu('medical_referral_needed')+`</div>
<div><span class='wide'>Accepts Voucher:</span> `+lu('AcceptsVoucher')+`</div>
<br/>
`+labelPair("<span>Notes:</span>",lu('costs')+` `+lu('additional_notes')) + `
`+labelPair("<span>Costs:</span>",lu('costs')+` `+lu('costs_other')) + `

</div>
`;  



    return template;
}

function makeClinic(clinic){
    
    var fields = keys(clinic).sort();
    var clinicElement = $('<div class="clinic"><h3>'+clinic['name_of_collection_site']+'</h3></div>');
    var datas = []
    //console.log(fields);
    for (var i =0;i<fields.length;i++){
        var fname = fields[i];
        var val = clinic[fname];
        if (val != null){
              var el  = '<div>'+fname+':'+val+'</div>';
              datas.push(el);
        }
     

        //var el = 
        //$("hello").appendTo(clinicElement);
        
    }

    //datas.appendTo(clinicElement);
    var fl = $('<div />',{html: datas.join("")});
    fl.appendTo(clinicElement);
    //clinicElement = $(template);
    var t = $(fillTemplate(clinic));
    //t.appendTo(clinicElement);
    //return clinicElement;
    return t;

}

// We use this to make a city and then the clinics & sites within it
function makeCity(city,xs){

    var city = cleanCity(city);
    var links = $('<a name="'+city+'" /><a name="'+city.toLowerCase()+'"/>');
    var link = $('<a href="#'+city.toLowerCase()+'">'+city+'</a>');

    // Add options to our select menu
    if (xs.length > 1){
        var option = $('<option value="'+city.toLowerCase()+'">'+city+ '('+xs.length+')'+'</option>');
    } else {
          var option = $('<option value="'+city.toLowerCase()+'">'+city+ '</option>');
    }

    option.appendTo($("#menu")[0]);
    link.appendTo($('#citylinks')[0]);
 
    if (xs.length>1){
      var qtytestinglocation =  xs.length + ' sites';
    } else {
      var qtytestinglocation =  xs.length + ' site';
    }
  if (xs.length > 1){
    var cityElement = $('<div class="City"><h2>'+city+ ' : '+qtytestinglocation+'</h2></div>');
    } else {
      var cityElement = $('<div class="City"><h2>'+city+ '</div>'); 
    }
    //console.log(xs);
    xs.sort((a, b) => (a.name_of_collection_site.toLowerCase() > b.name_of_collection_site.toLowerCase()) ? 1 : -1)

    for (var i = 0;i<xs.length;i++){
        clinic = xs[i];

        var clinicElement = makeClinic(clinic);
        clinicElement.appendTo(cityElement);

    }
    links.appendTo("body");
    cityElement.appendTo("body");
}


// We use this to make each site.
function clinic(cities,fields,geo){
    //console.log(geo.x,geo.y);
    //var city = fields.city;
    var city = cleanCity(fields.city);

    // if the city is missing, add it to unknown
    if (city == null | city == ''){
        city = 'Unknown';
    } else {

        city = city.trim();
    }
    //console.log('city '+city);

    // if we have never seen this city before...  
    if (cities[city]==undefined){
        cities[city] = [];
    }

    fields.x = geo.x;
    fields.y = geo.y;

    cities[city].push(fields);
};


function dataCleanup(val){
  //console.log('cleanup',val.attributes);
  if (val.attributes.globalid == 'a386e3dc-ff2d-49e5-8904-96ebaa1ad4f8'){
      val.attributes.city = 'Bethel';
    }
    if (val.attributes.globalid =='9bad2146-9e8e-4e25-8056-16aadeaf8c20'){
      val.attributes.city = 'Point Hope';
    }
    if (val.attributes.globalid =='e61bf34b-9106-4d8e-8b0a-08aaf194bc34'){
      val.attributes.city = 'Healy';
    }
    if (val.attributes != undefined){
      val.attributes.city = cleanCity(val.attributes.city);
    } else {
      console.log("undefined val attrs");
      //console.log(val);
    }
    //
    return val;
}


function afterLoad(data){

        var cities = {};
        var items = [];
        //console.log('data',data);
        // $.each(data,function(key,val){
        //   console.log(key,val);
        // });
        $.each( data.features, function( key, val ) {

          val = dataCleanup(val);
          //console.log(val);
          clinic(cities,val.attributes,val.geometry);
          //items.push( "<li id='" + key + "'>" +key+  ':'+ val.attributes + "</li>" );
        });
       
        // $( "<ul/>", {
        //   "class": "my-new-list",
        //   html: items.join( "" )
        // }).appendTo( "body" );
      var cities_sorted = keys(cities).sort();
      //console.log(cities_sorted);
      for (var i = 0;i<cities_sorted.length;i++) {
          var key = cities_sorted[i];
          // check if the property/key is defined in the object itself, not in parent
          if (cities.hasOwnProperty(key)) {           
              //console.log(key, cities[key].length);
              makeCity(key,cities[key]);
          }
      }


        $(document).ready(function(){

          if (inIframe()){
              $('#sitelink').each(function() {        
                  $(this).attr('target', '_top');       
              });
              ga('send', 'event', 'pageload', 'inframe', 'inframe');


          } else {


              $('#sitelink').each(function() {        
                  $(this).attr('target', '_self');       
              });

              $('.opennew').each(function() {
                $(this).hide();
              });

              ga('send', 'event', 'pageload', 'noframe', 'noframe');

        }

        

        });



}

$.ajaxSetup({
    timeout: 2000 //Time in milliseconds
});



var url = 'https://services1.arcgis.com/WzFsmainVTuD5KML/arcgis/rest/services/Testing_Sites_Public_View/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json';
//var url = 'x';
  c = $.getJSON( url, function( data ) {
        afterLoad(data);
        $("#menuboxloading").slideUp();
        ga('send', 'event', 'load', 'json', 'soa');
    }).fail(function() {
    //alert( "error" );
          //alert("unable to load from SOA");
          c = $.getJSON( './data.json', function( data ) {
                afterLoad(data);
                $("#menuboxloading").slideUp();
                $("#menuboxsoa").slideDown();
                ga('send', 'event', 'load', 'json', 'cache');
                //alert("loaded from json");
            }).fail(function() {

                $("#menuboxloading").slideUp();
                $("#menuboxfail").slideDown();
                $("#menubox").slideUp();
                ga('send', 'event', 'load', 'json', 'fail');
            //alert( "error" );   

            });



    });




</script>


</body>
</html>
